Install protobuf & smb_gazebo environment
=================

NOTE：Issues while learning ETH Programming for Robotics Introduction to ROS Course 1
homepage：https://rsl.ethz.ch/education-students/lectures/ros.html  
## Installation steps  
1. remove old protobuf（optional）  
$ sudo apt-get remove libprotobuf-dev  
look up protoc path  
$ whereis protoc  
protoc: /usr/bin/protoc /usr/local/bin/protoc /usr/share/man/man1/protoc.1.gz  
remove protoc  
$ rm /usr/local/bin/protoc /usr/local/bin/protoc 
$ sudo rm -rf /usr/local/include/google  
$ sudo rm -rf /usr/local/include/protobuf*  
$ sudo rm -rf /usr/include/google  
$ sudo rm -rf /usr/include/protobuf*  

2. Install protobuf 2.6.1 using source code  
wget  https://github.com/protocolbuffers/protobuf/archive/refs/tags/v2.6.1.tar.gz -O ~/Downloads/protobuf-2.6.1.tar.gz  
cd ~/Downloads  
tar xzf protobuf-2.6.1.tar.gz  
cd protobuf-2.6.1  
sudo apt-get update  
sudo apt-get install build-essential  
./autogen.sh  
./configure  
sudo make  
sudo make check  
sudo make install   
sudo ldconfig  
protoc --version  

3. Install protobuf 3.4.0 using source code（for cartographer）  
wget   https://github.com/protocolbuffers/protobuf/archive/refs/tags/v3.4.0.tar.gz -O ~/Downloads/protobuf-3.4.0.tar.gz  
cd ~/Downloads  
tar xzf protobuf-3.4.0.tar.gz  
cd protobuf-3.4.0  
sudo apt-get update  
sudo apt-get install build-essential  
./autogen.sh  
./configure --prefix=/home/${USERNAME}/carto_ws/protobuf --enable-shared=yes  ##set install path  
sudo make  
sudo make check  
sudo make install   
sudo ldconfig  
protoc --version  

4. Install other dependency  
sudo apt install ros-${ROS_DISTRO}-camera-info-manager  
sudo apt install ros-${ROS_DISTRO}-moveit-msgs  
sudo apt install ros-${ROS_DISTRO}-control-toolbox   
sudo apt install ros-${ROS_DISTRO}-controller-manager  
sudo apt install ros-${ROS_DISTRO}-transmission-interface  
sudo apt install ros-${ROS_DISTRO}-joint-limits-interface  
sudo apt install ros-${ROS_DISTRO}-polled-camera  

5. Download smb/gazebo pkgs in src   
hector_gazebo：https://github.com/tu-darmstadt-ros-pkg/hector_gazebo.git  
gazebo_ros_pkgs：https://github.com/ros-simulation/gazebo_ros_pkgs.git 
（kinetic-devel）  
smb_common： https://rsl.ethz.ch/education-students/lectures/ros.html  
teleop_twist_keyboard： https://github.com/ros-teleop/teleop_twist_keyboard.git  
velodyne_simulator: https://github.com/florianshkurti/velodyne_simulator.git  
6. reate symbol link  
sudo ln -s ~/${work_space}/src/velodyne_simulator/ /opt/ros/kinetic/share  
7. make  
catkin clean  
catkin build  

## some issues
1. smb_gazebo couldn’t find header file :gazebo_plugins/PubQueue.h: No such file or directory  
modify CMakelists  
include_directories(
  ${PROJECT_SOURCE_DIR}/../../gazebo_ros_pkgs/gazebo_plugins/include)  

2. sudo apt install libgazebo9-dev  
It will install protobuf 2.6 at /usr/, causing #error This file was generated by an older version of protoc
cartographer requires protobuf version (>3.0.0)，while gazebo requiring version 2.6.   
If there are multiple versions of protoc in the system, they are likely to conflict. The solution is to use protoc(2.6.1) in the system environment and protoc(3.4) in the carto_ws.   

3. Compile Cartographer with protoc 3.4.0  
catkin_make_isolated --install --use-ninja -DCMAKE_PREFIX_PATH=/home/${USERNAME}/carto_ws/protobuf/  
